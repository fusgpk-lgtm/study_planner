<div class="student-detail">
  <h2 class="student-detail-name"><%= @student.name %> さんのカリキュラム</h2>
  <p class="student-detail-goal">目標: <%= @student.goal_school %></p>

  <!-- タブ（見た目だけ） -->
  <div class="student-tabs">
    <span class="tab active">カリキュラム</span>
    <span class="tab">概要・成績</span>
    <span class="tab">授業履歴</span>
  </div>

  <!-- カリキュラム表 -->
  <div class="curriculum-container">
    <table class="curriculum-table">
      <thead>
        <tr>
          <th>教材 / 単元名</th>
          <th>年間スケジュール</th>
        </tr>
      </thead>

      <tbody>
        <% @textbooks.each do |textbook| %>
          <!-- 教材名と単元追加ボタン -->
          <tr class="textbook-header">
            <td colspan="2">
              <div class="textbook-header-content">
                <strong><%= textbook.title %></strong>
                <%= link_to new_textbook_unit_path(textbook), class: "btn-add-unit" do %>
                  <i data-lucide="plus-circle" class="icon"></i>
                  単元を追加
                <% end %>
              </div>
            </td>
          </tr>

          <% textbook.units.each do |unit| %>
            <% progress = unit.progresses.find_by(student_id: @student.id) %>
            <% completed = progress ? (progress.completed || 0) : 0 %>

            <tr>
              <td class="curriculum-textbook">
                <div class="textbook-unit"><%= unit.title %></div>
              </td>

              <td class="curriculum-progress">
                <div class="progress-bar-container"
                     title="<%= progress&.start_date&.strftime('%m/%d') %> ~ <%= progress&.end_date&.strftime('%m/%d') %>">
                  <div class="progress-bar"
                       style="width: <%= completed %>%;
                              background-color: <%= completed == 100 ? '#10b981' : '#6366f1' %>;">
                    <span class="progress-text"><%= completed %>%</span>
                  </div>
                </div>

                <% if progress&.start_date && progress&.end_date %>
                  <p class="progress-date">
                    <%= progress.start_date.strftime('%m/%d') %> ~ <%= progress.end_date.strftime('%m/%d') %>
                  </p>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="add-unit-global">
    <%= link_to new_textbook_unit_path(@textbooks.first), class: "btn-add" do %>
      <i data-lucide="plus-circle" class="icon"></i>
      新しい教材に単元を追加
    <% end %>
  </div>
</div>